<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>TrackLink</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
        background-color: #121212;
        color: #f1f1f1;
        font-family: 'Segoe UI', sans-serif;
        margin: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .ip-box {
  background: #1e1e1e;
  border-radius: 12px;
  padding: 16px 24px;
  font-size: 1.5rem;
  letter-spacing: 2px;
  color: #ddd;
  box-shadow:
    0 0 8px #6a11cb88,
    0 0 20px #6a11cbbb,
    inset 0 0 10px #6a11cbcc;
  user-select: all;
  flex-grow: 1;
  text-align: center;
  transition: box-shadow 0.3s ease;
}

.ip-box:focus {
  outline: none;
  box-shadow:
    0 0 12px #8a4fffdd,
    0 0 30px #8a4fffee,
    inset 0 0 15px #8a4fffee;
}

.btn-copy-glow {
  background: transparent;
  border: 2px solid #6a11cb;
  color: #6a11cb;
  padding: 8px 18px;
  font-weight: 600;
  font-size: 1rem;
  border-radius: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
}

.btn-copy-glow svg {
  fill: currentColor;
}

.btn-copy-glow:hover {
  background-color: #6a11cb;
  color: #fff;
  box-shadow: 0 0 15px #6a11cbbb;
}

.btn-copy-glow.copied {
  background-color: #4ade80; /* bright green success */
  color: #064e3b;
  border-color: #4ade80;
  box-shadow: 0 0 12px #4ade80bb;
}

    .container-box {
        background: #1e1e1e;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        max-width: 600px;
        width: 100%;
        margin: 40px auto;
        animation: fadeIn 0.7s ease;
        text-align: center;
    }
    h2 {
        margin-bottom: 30px;
        color: #ffffff;
    }
    .form-control {
        background-color: #2c2c2c;
        color: #fff;
        border: 1px solid #444;
    }
    .form-control::placeholder {
        color: #aaa;
    }
    .btn-generate {
        background: linear-gradient(to right, #6a11cb, #2575fc);
        color: white;
        border: none;
        padding: 10px 20px;
        font-weight: bold;
        transition: transform 0.2s;
        cursor: pointer;
    }
    .btn-generate:hover {
        transform: scale(1.05);
    }
    .custom-link {
        margin-top: 20px;
        background-color: #2c2c2c;
        padding: 15px;
        border-left: 5px solid #6a11cb;
        border-radius: 5px;
        word-break: break-word;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    .link-text {
        flex: 1;
        margin-right: 10px;
        overflow-wrap: anywhere;
    }
    .btn-copy {
        background: #6a11cb;
        border: none;
        color: white;
        padding: 6px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .btn-copy:hover {
        background: #2575fc;
    }
    footer {
        background-color: #1e1e1e;
        text-align: center;
        padding: 15px 0;
        font-size: 0.9rem;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .secondary-nav {
        background: #1a1a1a;
        border-bottom: 1px solid #333;
        text-align: center;
    }
    .secondary-nav a {
        padding: 10px 20px;
        display: inline-block;
        color: #ccc;
        text-decoration: none;
    }
    .secondary-nav a:hover {
        background: #2a2a2a;
        color: #fff;
    }
    .secondary-nav a.active {
        color: #6a11cb;
        font-weight: 600;
        border-bottom: 2px solid #6a11cb;
        padding-bottom: 8px;
    }
    .navbar {
        background-color: #1e1e1e !important;
    }
    .navbar-brand, .nav-link {
        color: #f1f1f1 !important;
    }
    .nav-link:hover {
        color: #ffffff !important;
    }
    .btn-outline-primary {
        border-color: #6a11cb;
        color: #6a11cb;
    }
    .btn-outline-primary:hover {
        background-color: #6a11cb;
        color: white;
    }
    .ip-card {
        background-color: #2c2c2c;
        padding: 30px;
        border-radius: 12px;
        font-size: 1.4rem;
        letter-spacing: 1.5px;
        box-shadow: 0 0 15px #6a11cbaa;
        user-select: all;
        max-width: 350px;
        margin: 0 auto;
        font-family: monospace;
    }
    .logout-link:hover {
        color: #ff4757 !important;
        transform: scale(1.05);
        transition: all 0.3s ease;
    }
  </style>
</head>
<body>

<!-- PRIMARY NAVBAR -->
<nav class="navbar navbar-expand-lg shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">TrackLink</a>
    <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon text-white"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav me-3">
        <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Features</a></li>
        <li class="nav-item"><a class="nav-link" href="#">About</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
        <li class="nav-item d-flex align-items-center me-3">
          <span class="nav-link text-light" style="font-size: 0.9rem;">
            Welcome, <span th:text="${username}" style="color: #6a11cb; font-weight: 600;"></span>
          </span>
        </li>
        <li class="nav-item d-flex align-items-center">
          <a class="nav-link logout-link" href="/logout" title="Logout" style="display: flex; align-items: center; gap: 6px; color: #ff6b6b; transition: color 0.3s ease;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
              <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
            </svg>
            <span style="font-size: 1rem; font-weight: 500;">Logout</span>
          </a>
        </li>
      </ul>
<!--      <a class="btn btn-outline-primary" href="#">Login / Sign Up</a>-->
    </div>
  </div>
</nav>

<!-- SECONDARY NAVBAR -->
<div class="secondary-nav">
  <a href="/my-ip" th:classappend="${activePage == 'my-ip'} ? 'active' : ''">My IP</a>
  <a href="/ip-lookup" th:classappend="${activePage == 'ip-lookup'} ? 'active' : ''">IP Lookup</a>
  <a href="/track-via-link" th:classappend="${activePage == 'track-via-link'} ? 'active' : ''">Track via Link</a>
  <a th:href="@{/tracker/log(username=${username})}" th:classappend="${activePage == 'log'} ? 'active' : ''">Log</a>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">
  <div class="container-box text-center">
    <div th:switch="${activePage}">

      <!-- My IP Page Content -->
      <div th:case="'my-ip'">
        <h2>üì° Your Current IP Address</h2>
        <div
                class="ip-container"
                style="max-width: 350px; margin: 0 auto; display: flex; align-items: center; gap: 12px;"
        >
          <div
                  id="ipDisplay"
                  class="ip-box"
                  th:text="${clientIp}"
                  style="user-select: all; font-family: monospace;"
          >
            Loading your IP...
          </div>
          <button
                  id="copyIpBtn"
                  class="btn-copy-glow"
                  aria-label="Copy IP"
                  title="Copy IP"
                  onclick="copyIp()"
          >
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                    class="bi bi-clipboard"
            >
              <path
                      d="M10 1.5v1h1a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h1v-1a1 1 0 0 1 2 0z"
              />
              <path d="M8 4.5a.5.5 0 0 0-.5.5v.5h1v-.5a.5.5 0 0 0-.5-.5z" />
            </svg>
            <span>Copy</span>
          </button>
        </div>
      </div>


      <!-- Track via Link Page Content -->
      <div th:case="'track-via-link'">
        <h2>üîó Custom Link Tracker</h2>
        <input
                type="text"
                id="originalLink"
                class="form-control mb-3"
                placeholder="Paste the URL you want to track..."
        />
        <button class="btn btn-generate w-100" onclick="generateLink()">Generate</button>
        <div id="generatedLink" class="custom-link d-none mt-4"></div>
      </div>

      <!-- IP Lookup Page Content -->
      <div th:case="'ip-lookup'">
        <h2>üîç IP Lookup</h2>
        <input
                type="text"
                id="lookupIp"
                class="form-control mb-3"
                placeholder="Enter an IP address"
        />
        <button class="btn btn-generate w-100 mb-3" onclick="lookupIP()">Look Up</button>
        <div id="lookupResult" class="custom-link d-none"></div>
      </div>

    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="container">
    <p>&copy; 2025 TrackLink. All rights reserved.</p>
  </div>
</footer>

<script>
  // Custom link generator functions
  function generateShortCode(length = 8) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      let code = "";
      for (let i = 0; i < length; i++) {
          code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
  }

  function generateLink() {
      const input = document.getElementById("originalLink").value.trim();
      const display = document.getElementById("generatedLink");
      const usernameSpan = document.querySelector('[th\\:text="${username}"]');
      const username = usernameSpan ? usernameSpan.textContent.trim() : '';

      if (!input) {
          alert("Please enter a valid URL.");
          return;
      }

      const shortCode = generateShortCode();
      const baseUrl = window.location.origin;
      const customLink = `${baseUrl}/home?redirect=${encodeURIComponent(input)}&code=${shortCode}&username=${encodeURIComponent(username)}`;

      display.innerHTML = `
          <span class="link-text">‚úÖ Your custom link: <a href="${customLink}" target="_blank">${customLink}</a></span>
          <button class="btn-copy" onclick="copyToClipboard('${customLink}')">Copy</button>
      `;
      display.classList.remove("d-none");
  }

  function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {

      }).catch(() => {
          alert("Failed to copy link. Please copy manually.");
      });
  }

  // Copy IP function with feedback
  function copyIp() {
  const ipText = document.getElementById("ipDisplay").innerText;
  const btn = document.getElementById("copyIpBtn");
  navigator.clipboard.writeText(ipText).then(() => {
    btn.classList.add("copied");
    setTimeout(() => {
      btn.classList.remove("copied");
    }, 1500);
  }).catch(() => {
    alert("Failed to copy IP. Please copy manually.");
  });
}


  // Placeholder for IP lookup function ‚Äî implement later as needed
  async function lookupIP() {
    const ip = document.getElementById('lookupIp').value.trim();
    const resultDiv = document.getElementById('lookupResult');
    if (!ip) {
      alert("Please enter a valid IP address.");
      return;
    }
    resultDiv.classList.add('d-none');

    try {
      const backendUrl = "";  // adjust as needed
      const response = await fetch(`${backendUrl}/home/api/ip-lookup?ip=${encodeURIComponent(ip)}`);
      if (!response.ok) throw new Error('Network error');

      const data = await response.json();
      resultDiv.innerHTML = formatIpData(data);
      resultDiv.classList.remove('d-none');
    } catch (error) {
      resultDiv.innerHTML = `<p style="color:red;">Error fetching IP info: ${error.message}</p>`;
      resultDiv.classList.remove('d-none');
    }

    function formatIpData(data) {
      if (!data || data.status !== "success") {
        return `<p style="color:red;">Failed to get IP information.</p>`;
      }

      // Build URLSearchParams from the IP data to pass to map page
      const params = new URLSearchParams({
        ip: data.query || '',
        country: data.country || '',
        countryCode: data.countryCode || '',
        region: data.regionName || '',
        regionCode: data.region || '',
        city: data.city || '',
        zip: data.zip || '',
        lat: data.lat || '',
        lon: data.lon || '',
        timezone: data.timezone || '',
        isp: data.isp || '',
        org: data.org || '',
        as: data.as || '',
      });

      const mapPageUrl = `/map.html?${params.toString()}`;

      return `
        <div style="text-align: left; max-width: 500px; margin: auto; font-family: monospace; line-height: 1.5;">
          <p><strong>Country:</strong> ${data.country} (${data.countryCode})</p>
          <p><strong>Region:</strong> ${data.regionName} (${data.region})</p>
          <p><strong>City:</strong> ${data.city}</p>
          <p><strong>ZIP:</strong> ${data.zip || 'N/A'}</p>
          <p><strong>Latitude:</strong> ${data.lat}</p>
          <p><strong>Longitude:</strong> ${data.lon}</p>
          <p><strong>Timezone:</strong> ${data.timezone}</p>
          <p><strong>ISP:</strong> ${data.isp}</p>
          <p><strong>Organization:</strong> ${data.org || 'N/A'}</p>
          <p><strong>AS:</strong> ${data.as || 'N/A'}</p>

          <button
            onclick="window.location.href='${mapPageUrl}'"
            style="margin-top: 15px; background: #6a11cb; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;"
          >
            üìç View on Map
          </button>
        </div>
      `;
    }
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
